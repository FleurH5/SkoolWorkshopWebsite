<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Workshop toevoegen</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="addcommission.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>
  <body>
    <nav-bar></nav-bar>
    <side-nav></side-nav>
    <script src="../adminnavcomponents.js"></script>
    <!-- de links werken niet omdat ze niet allemaal in hetzelfde mapje zitten -->
  

     <!-- popup -->
     <div class="alert alert-success" role="alert">
      <strong>Succes!</strong> Opdracht is succesvol toegevoegd.
    </div>
    <div class="container mt-5">
      <div class="content">

    <h1>Voeg een opdracht toe</h1>
    <form id="commissionForm">
      <div class="form-group mb-3">
        <label for="commissionName">Naam Opdracht *</label>
        <input required type="text" class="form-control" id="commissionName" name="commissionName" placeholder="Voer de naam van de opdracht in" required>
      </div>
      <div class="row">
      <div class="form-group col-md-6">
        <label for="mySelectedClient">Klant *</label>
      <select required class="form-select" name="mySelectedClient" id="mySelectedClient">
        <option selected>Selecteer een klant</option>
        <option value="1">AVANS</option>
        <option value="2">Basisschool De Regenboog</option>
        <!-- <option value="#">#</option>
        <option value="#">#</option> -->
      </select> 
    </div>
    <!-- doe deze automatisch als een klant geselecteerd is -->
      <div class="form-group col-md-6">
        <label for="address">Adres *</label>
        <input required type="text" class="form-control" name="address" id="address" rows="3" placeholder="Voer het adres in"></input>
      </div> 
    </div>
    <!-- <div class="row"> -->
      <div class="form-group mb-3">
        <label for="date">Datum *</label>
        <input required type="date" class="form-control" name="date" id="date" rows="3" placeholder="Voer de datum in"></input>
      </div> 
      <!-- <div class="form-group col-md-6">
        <label for="startTime">Aanvangstijd *</label>
        <input required type="time" class="form-control" name="startTime" id="startTime" rows="3" placeholder="Voer de aanvangstijd in"></input>
      </div>  -->
    <!-- </div> -->
    <!-- <div class="form-group mb-3">
        <label for="rounds">Aantal rondes *</label>
        <input required type="number" class="form-control" name="rounds" id="rounds" rows="3" placeholder="Voer het aantal rondes in">
    </div> -->
      <div class="form-group mb-3">
        <label for="notes">Extra Toelichting</label>
        <textarea class="form-control" name="notes" id="notes" rows="3" placeholder="Voer de benodigde extra toelichtingen in indien nodig"></textarea>
      </div>
      <div class="form-group mb-3" id="new-input-container"></div>
    <p class="add-new-shareholders-p">
        <button class="btn btn-primary">Workshops toevoegen +</button>
    </p>
      <!-- 

        einde

       -->
      <button type="submit" class="btn btn-primary">Voeg de opdracht toe</button>
    </div>
    </div>


    <!-- The workshop button clicked. new input fields -->
    <script>
      document.querySelector('.btn').addEventListener('click', createNewInputFields);
      
      function createNewInputFields() {
          const container = document.getElementById('new-input-container');
          const inputHtml = `
          <div class="form-container mt-5">
              <div class="content-extra-box">
                  <button class="close-btn" onclick="removeForm(this)">X</button>
                  <p><b>Voeg een workshop toe</b></p>
                  <form id="workshopIncommissionForm" class="set-center">
                      <div class="form-group mb-3">
                          <label for="workshop">Workshop *</label>
                          <select required class="form-select" id="workshop">
                              <option selected>Selecteer een workshop</option>
                              <option value="w1">Vloggen</option>
                              <option value="w2">Openbaar Spreken</option>
                              <option value="w3">Python Programmeren</option>
                              <option value="w4">Java Programmeren</option>
                          </select>
                      </div>
                      <div class="row">
                          <div class="form-group col-md-6">
                              <label for="teachersNeeded">Aantal docenten *</label>
                              <input required type="number" class="form-control" name="teachersNeeded" id="teachersNeeded" placeholder="Voer het aantal nodige docenten in">
                          </div> 
                          <div class="form-group col-md-6">
                              <label for="participants">Aantal deelnemers *</label>
                              <input required type="number" class="form-control" name="participants" id="participants" placeholder="Voer het aantal deelnemers in">
                          </div> 
                      </div>
                      <div class="row">
                          <div class="form-group col-md-6">
                              <label for="grade">Leerjaar</label>
                              <input type="text" class="form-control" name="grade" id="grade" placeholder="Voer het leerjaar in">
                          </div> 
                          <div class="form-group col-md-6">
                              <label for="level">Niveau</label>
                              <select required class="form-select" id="level">
                              <option selected>Selecteer een niveau</option>
                              <option value="beginner">Beginner</option>
                              <option value="gevorderd">Gevorderd</option>
                              </select>
                          </div> 
                      </div>
                      <div class="row">
                        <div class="form-group col-md-6">
                          <label for"startTime">Begintijd *</label>
                          <input type="time" class="form-control" name="startTime" id="startTime"></input>
                          </div>
                          <div class="form-group col-md-6">
                          <label for"endTime">Eindtijd *</label>
                          <input type="time" class="form-control" name="endTime" id="endTime"></input>
                          </div>
                        </div><br>
                        <div class="form-group md-3">Duur van de workshop: X minuten</div><br>
                        <div class="form-group md-3">
                          <label class="location">Werklocatie</label>
                          <input type="text" class="form-control" name="location" id="location" placeholder="Werklocatie, indien anders dan adres"></input>
                        <div class="form-group md-3">
                          <label class="workshopNotes">Notities</label>
                          <textarea class="form-control" name="workshopNotes" id="workshopNotes" placeholder="Voer notities in"></textarea>
                  </form>
              </div>
          </div>
          `;
          container.insertAdjacentHTML('beforeend', inputHtml);
      }

      function removeForm(button) {
          button.closest('.form-container').remove();
      }
    </script>

 <!-- <div class="form-group mb-3">
       <label for="duration">Duur van de workshop *</label>
       <input required type="number" class="form-control" name="duration" id="duration" placeholder="Voer de duur van de in workshop in (in minuten)">
   </div>
 <div class="form-group mb-3">
       <label for="assignedRound">Aangewezen ronde</label>
     <input type="text" class="form-control" name="assignedRound" id="assignedRound" placeholder="Voer in in welke ronde deze workshop plaats zal vinden">
 </div> -->


 <!-- mySelectedClient -->
<script>
//fetch options from server
   fetch('/all-clients')
  .then(response => response.json())
  .then(data => {
    try {
    const select = document.getElementById('mySelectedClient');
    data.forEach(item => {
      const option = document.createElement('option');
    option.value = item.value;
    option.textContent = item.text;
    select.appendChild(option)
    });
  }catch {
    console.error('Error:', error);
  }
  });
    
</script>  


 <!-- Add to the database. (for now only the 'opdracht' parts) -->
 <script>
  const thisForm = document.getElementById('commissionForm');
  thisForm.addEventListener('submit', async function(event) {
    event.preventDefault();
    //waardes ophalen
    const commissionName = document.getElementById('commissionName').value;
    const client = document.getElementById('client').value;
    const address = document.getElementById('address').value;
    const date = document.getElementById('date').value;
    const notes = document.getElementById('notes').value;

    //workshop waardes
    const workshop = [];
    document.querySelectorAll('.form-container').forEach(container => {
      const workshop = container.querySelector('select[name="workshop"]').value;
      const teachersNeeded = container.querySelector('select[name="teacherNeeded"]').value;
      const participants = container.querySelector('input[name="participants"]').value;
          const grade = container.querySelector('input[name="grade"]').value;
          const level = container.querySelector('select[name="level"]').value;
          const startTime = container.querySelector('input[name="startTime"]').value;
          const endTime = container.querySelector('input[name="endTime"]').value;
          const location = container.querySelector('input[name="location"]').value;
          const workshopNotes = container.querySelector('textarea[name="workshopNotes"]').value;
          workshops.push({
            workshop: workshop,
            teachersNeeded: teachersNeeded,
            participants: participants,
            grade: grade,
            level: level,
            startTime: startTime,
            endTime: endTime,
            location: location,
            workshopNotes: workshopNotes
          });
          console.log(workshop);
        });
    //object aanmaken
    const formObject = {
      commissionName: commissionName,
      client: client,
      address: address,
      date: date,
      notes: notes
    };
    console.log(formObject);

    const apiUrl = 'https://skoolworkshopapi.azurewebsites.net/commission/add';
    try{
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formObject)
      });
      if(response.ok){
        console.log('Opdracht toegevoegd');
        const result = await response.json();
        // Show success popup
        showPopup();
        // Clear form
        document.getElementById('commissionForm').reset();
      } else {
        console.error('Opdracht niet toegevoegd');
      }
    } catch (error) {
      console.error('Error:', error);
    }
    });

    function showPopup() {
      const successPopup = document.querySelector('.alert-success');
      successPopup.style.display = 'block';
      setTimeout(() => {
        successPopup.style.display = 'none';
      }, 3000);
    }
</script>







    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
</html>